---
title: "GP_6306_CaseStudy2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Hmisc)
library(rvest)
library(tidyr)
library(ggplot2)
library(dplyr)
```

#2. Clean your Raw Data
#### a. Row and Column count
```{r}
df.procrastination <- read.csv("csv/Procrastination.csv")
# columns
length(df.procrastination)
# rows
nrow(df.procrastination)
```

#### b. Update Column names
```{r}
currentColumns <- names(df.procrastination)
# The columns that pertain to survey question are broken down into good "Gd" and bad "bad" categories.
newColumnNames <- c("Age", "Gender", "HaveKids", "Ed.Level", "WorkStatus", "Income", "Occupation", "YearsAtJob", 
                    "MonthsAtJob", "Community", "Country", "MaritalStat", "Sons", "Daughters", "BdWstTime", "BdDelayAct", 
                    "BdMustAct", "BdDelayMake", "BdPutOff", "GdPayBills", "GdPunctual", "GdPrepared", "BdRunLate", "BdCmpltTm",
                    "GdWantGrow", "BdFamView", "GdTmToSpare", "BdDeadline", "BdTmMngmt", "GdDocApt", "GdMorePunct", 
                    "GdMaint", "BdXpctLate", "BdCostMoney", "BdLateStart", "BdMissTckts", "GdPartyPln", "GdEasyWake", "BdSlowMail", 
                    "GdRtnCalls", "BdWrkr", "GdDecisive", "BdWrkDelay", "BdAirport", "GdSocial", "BdDeadline", "GdSMLBill", 
                    "GdRSVP", "GdTask", "BdBdayGFT", "BdEsntlItem", "GdCmplteDay", "BdDoTmrow", "GdEvngTasks", "GdIdealLIfe",
                    "GdExclLife", "GdSatisLife", "GdImprtThs", "GdChangeNil", "SelfView", "ExtView")
names(df.procrastination) <- newColumnNames
```

#### c. Column Cleanup
```{r}
#i. fix impossible data values
# fix years at job
# replace NA with zero.  No point in guessing what the value is or if it is actually zero because 
df.procrastination$YearsAtJob[mapply(is.na, df.procrastination$YearsAtJob)] <- 0

# if the value is 999, we have to assume in invalid value and default to zero since.  No help found in other
# columns to shed light on this.
df.procrastination$YearsAtJob[mapply(function(x) x == 999, df.procrastination$YearsAtJob)] <- 0

# round years at work to the nearest integer
df.procrastination$YearsAtJob <- round(df.procrastination$YearsAtJob, digits = 0)

# ii. Fix Sons column.  
# Change Male to 1 and Female to 0.  The logic here being that someone read the survey wrong and put in 
# the child type in instead of the count.  Female doesn't show a correspondance to the Female column so 
# setting to zero makes the most sense.
df.procrastination$Sons <- sapply(df.procrastination$Sons, function(x) {
  value = 0
  if(x == "Male") {
    value = 1
  } else if(x == "Female") {
    value = 0
  }
  value
})

# iii. Set 0 country of resisidence to NA
df.procrastination$Country[df.procrastination$Country == 0] <- NA

# iv. Clean Occupation Column
# convert zeros to NA's
df.procrastination$Occupation[df.procrastination$Occupation == 0] <- NA
# convert 'please specify' to NA's
df.procrastination$Occupation[df.procrastination$Occupation == 'please specify'] <- NA

# first convert to chars for easier manipulation
df.procrastination$Occupation <- as.character(df.procrastination$Occupation)
# create writer category
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[wW]rit")] <- "Writer"
# create VP category
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[vV]ice")] <- "VP"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "VP")] <- "VP"
# create TV Broadcasting category
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^TV")] <- "Broadcasting"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[tT]elevision")] <- "Broadcasting"
# add to IT Category
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[tT]ech")] <- "IT"
# create Tax
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[tT]ax")] <- "Tax Work"
# add to System Analyst
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^System")] <- "System Analyst"
# add to doctor
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Surgeon")] <- "Doctor"
# add to supervisor
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]upervis")] <- "Supervisor"
# create Student
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]tude")] <- "Student"
# add to writer
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Staff Writer")] <- "Writer"
# add to teacher
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]pecial [eE]ducation")] <- "Teacher"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "teacher / Administrator")] <- "Teacher"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Teacher and Full")] <- "Teacher"
# Keeping software separate from IT as that would be overly broad
# add Software
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Software")] <- "Software"
# add to writer
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Writer$")] <- "Writer"
# Anyone who is self employeed should be group together regardless of trade given the tendencies of this group of people.
# add to self employed
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]elf")] <- "Self Employed"
# aggregate Secretary
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]ecretary")] <- "Secretary"
# aggregate sales
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]ales")] <- "Sales"
# add to student
df.procrastination$Occupation[df.procrastination$Occupation == "s"] <- "Student"
# aggregate RN
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^RN")] <- "RN"
# aggregate retired
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^retired")] <- "retired"
# aggregate Retail
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Retail")] <- "Retail"
# aggregate Manager
df.procrastination$Occupation[df.procrastination$Occupation == "Restaurant operations manager"] <- "Manager"
# add to student
df.procrastination$Occupation[df.procrastination$Occupation == "restaurant mgr / student / and looking f"] <- "Student"
# add to Doctor
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[pP]hysician")] <- "Doctor"
# aggregate Researcher
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[rR]esearch")] <- "Research"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Reasearch")] <- "Research"
# aggregate Real Estate
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^realtor")] <- "Real Estate"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[rR]eal [eE]state")] <- "Real Estate"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "realtor$")] <- "Real Estate"
# aggregate managers given their similarity in responsibilities
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Manager$")] <- "Manager"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Manager -")] <- "Manager"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Divisional Manager")] <- "Manager"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Program Manager")] <- "Manager"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Manager,Interacitve")] <- "Manager"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "manager")] <- "Manager"
# add to software
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Programmer")] <- "Software"
# add to engineer
df.procrastination$Occupation[df.procrastination$Occupation == 'Process Engineer'] <- "Engineer"
# aggregate president
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[pP]resident")] <- "President"
# create finance
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Private Equity Principal")] <- "Finance"
# add to manager
# looks like a copy paste issue so adding it to Manager
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Please specify title Manager for Regulat")] <- "Manager"
# aggregrate director do to important shared qualities
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "pjublic relations director")] <- "director"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "director")] <- "Director"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Director")] <- "Director"
# aggregrate Supervisor do to important shared qualities
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[sS]upervisor")] <- "Supervisor"
# aggregate PCA
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^PCA")] <- "PCA"
# add to self employed
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Attorney - self employed for 2 years â€“ f")] <- "Self Employed"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[oO]wner")] <- "Self Employed"
# aggregate Nurse
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "RN")] <- "Nursing"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Nurse")] <- "Nursing"
# add to engineer
# this is a very broad title, but again it comes down to shared traits that might influence procrastination
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[eE]ngineer")] <- "Engineer"
# change to just Nanny to correspond to the other subjects 
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Nanny")] <- "Nanny"
# add to Musician
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^musician")] <- "Musician"
# aggregate Medical
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[mM]edical")] <- "Medical"
# aggregate Marketing
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^marketing")] <- "Marketing"
# aggregate Market Research
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Market Research Analyst")] <- "Market Analyst"
# add to nursing
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "LPN")] <- "Nursing"
# add to college professor
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "lecturer")] <- "college professor"
# add to Journalist
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "journalist")] <- "Journalist"
# add to IT
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^IT")] <- "IT"
# add to finance
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[iI]nvestment")] <- "Finance"
# aggregate insurance
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[iI]nsurance")] <- "Insurance"
# add to IT
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Information Technology")] <- "IT"
# add to self employed
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Bar & Restaurant Owner")] <- "Self Employed"
# add to Student
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Graduate")] <- "Student"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "full time student and part time bartende")] <- "Student"
# add to Teacher
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "teacher$")] <- "Teacher"
# aggregate Financial
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[fF]inancial")] <- "Finance"
# aggregate Fitness
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Fitness")] <- "Fitness"
# aggregate film
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[fF]ilm")] <- "Film"
# add to teacher
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[sS]pecial [eE]ducation")] <- "Teacher"
# add to Entrepreneur
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[eE]ntrepreneur")] <- "Entrepreneur"
# add to Student
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Education")] <- "Student"
# add to Editor
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Editor")] <- "Editor"
# aggregate Economist
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Econom")] <- "Economist"
# add to Student
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^Doctoral Candidate!!!")] <- "Student"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Doctor Research")] <- "Student"
# aggregate customer service
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Customer Service")] <- "Customer Service"
# aggregate legal
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "^[lL]egal")] <- "Legal"
# add to student
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Computer Science")] <- "Student"
# aggregate Civil Servant
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[cC]ivil")] <- "Civil Servant"
# add to Self Employed
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "businesswoman")] <- "Self Employed"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Business Owner")] <- "Self Employed"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "self employed$")] <- "Self Employed"
# aggregate Attorney
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[aA]ttorney")] <- "Attorney"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "In-house Legal Counsel")] <- "Attorney"
# add to college  
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Asst. Prof.")] <- "college professor"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "[aA]ssistant [pP]rofessor")] <- "college professor"
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "university faculty")] <- "college professor"
# add to student
df.procrastination$Occupation[grep(df.procrastination$Occupation, pattern = "Utterly shiftless arts student")] <- "Student"
```

#### d. Convert Column data types
```{r}
# return to factor
df.procrastination$Occupation <- as.factor(df.procrastination$Occupation)
# set to int
df.procrastination$Sons <- as.integer(df.procrastination$Sons)
```

#### e. Create Procrastination Scales Means
```{r}
scaleMean <- function(df, columns) {
  rowMeans(subset(df, select = columns), na.rm = TRUE)
}

df.procrastination$DPMean <- scaleMean(df = df.procrastination, columns = c("BdWstTime", "BdDelayAct",
                                                                            "BdMustAct", "BdDelayMake",
                                                                            "BdPutOff"))

df.procrastination$AIPMean <- scaleMean(df = df.procrastination, columns = c("GdPayBills", "GdPunctual",
                                                                             "GdPrepared","BdRunLate",
                                                                             "BdCmpltTm","GdWantGrow", 
                                                                             "BdFamView", "GdTmToSpare", 
                                                                             "BdDeadline","BdTmMngmt", 
                                                                             "GdDocApt","GdMorePunct", 
                                                                             "GdMaint","BdXpctLate", 
                                                                             "BdCostMoney"))

df.procrastination$GPMean <- scaleMean(df = df.procrastination, columns = c("BdLateStart", "BdMissTckts", 
                                                                            "GdPartyPln", "GdEasyWake", 
                                                                            "BdSlowMail", "GdRtnCalls", 
                                                                            "BdWrkr", "GdDecisive", 
                                                                            "BdWrkDelay","BdAirport", 
                                                                            "GdSocial", "BdDeadline", 
                                                                            "GdSMLBill","GdRSVP", 
                                                                            "GdTask", "BdBdayGFT", 
                                                                            "BdEsntlItem","GdCmplteDay", 
                                                                            "BdDoTmrow", "GdEvngTasks"))

df.procrastination$SWLSMean <- scaleMean(df = df.procrastination, columns = c("GdIdealLIfe", "GdExclLife",
                                                                              "GdSatisLife", "GdImprtThs",
                                                                              "GdChangeNil"))
```

# 3. Scrape the human development index tables to create a bound table of all countries
#### a. Get the 8 HDI tables
```{r}
html.hdi <- read_html("https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index#Complete_list_of_countries")

# find the index of the tables
tables.hdi <- html_nodes(html.hdi, "table")

fetchTable <- function(index) {
  tables <- html.hdi %>%
    html_nodes("table") %>%
    .[index] %>%
    html_table(fill = T)
  data.frame(tables[1])
}

# very high human development tables 
df.hdi.vh1 <- fetchTable(4)
df.hdi.vh2 <- fetchTable(5)

# high human development tables
df.hdi.h1 <- fetchTable(7)
df.hdi.h2 <- fetchTable(8)

# medium human development tables
df.hdi.m1 <- fetchTable(10)
df.hdi.m2 <- fetchTable(11)

# low human development tables
df.hdi.l1 <- fetchTable(13)
df.hdi.l2 <- fetchTable(14)

# delete columns names in first row
df.hdi.vh1 <- df.hdi.vh1[-c(1), ]
df.hdi.vh2 <- df.hdi.vh2[-c(1), ]
df.hdi.h1 <- df.hdi.h1[-c(1), ]
df.hdi.h2 <- df.hdi.h2[-c(1), ]
df.hdi.m1 <- df.hdi.m1[-c(1), ]
df.hdi.m2 <- df.hdi.m2[-c(1), ]
df.hdi.l1 <- df.hdi.l1[-c(1), ]
df.hdi.l2 <- df.hdi.l2[-c(1), ]

# add column names
names.hdi <- c("Rank", "RankChange", "Country", "HDI", "HDIChange")
names(df.hdi.vh1) <- names.hdi
names(df.hdi.vh2) <- names.hdi
names(df.hdi.h1) <- names.hdi
names(df.hdi.h2) <- names.hdi
names(df.hdi.m1) <- names.hdi
names(df.hdi.m2) <- names.hdi
names(df.hdi.l1) <- names.hdi
names(df.hdi.l2) <- names.hdi

# remove unnecessary columns
deleteUnusedHDIColumns <- function(df) {
  df$Rank <- NULL
  df$RankChange <- NULL
  df$HDIChange <- NULL
  df
}

df.hdi.vh1 <- deleteUnusedHDIColumns(df.hdi.vh1)
df.hdi.vh2 <- deleteUnusedHDIColumns(df.hdi.vh2)
df.hdi.h1 <- deleteUnusedHDIColumns(df.hdi.h1)
df.hdi.h2 <- deleteUnusedHDIColumns(df.hdi.h2)
df.hdi.m1 <- deleteUnusedHDIColumns(df.hdi.m1)
df.hdi.m2 <- deleteUnusedHDIColumns(df.hdi.m2)
df.hdi.l1 <- deleteUnusedHDIColumns(df.hdi.l1)
df.hdi.l2 <- deleteUnusedHDIColumns(df.hdi.l2)

# add categories
df.hdi.vh1$HDICategory <- rep(as.factor("Very high human development"), nrow(df.hdi.vh1))
df.hdi.vh2$HDICategory <- rep(as.factor("Very high human development"), nrow(df.hdi.vh2))
df.hdi.h1$HDICategory <- rep(as.factor("High human development"), nrow(df.hdi.h1))
df.hdi.h2$HDICategory <- rep(as.factor("High human development"), nrow(df.hdi.h2))
df.hdi.m1$HDICategory <- rep(as.factor("Medium human development"), nrow(df.hdi.m1))
df.hdi.m2$HDICategory <- rep(as.factor("Medium human development"), nrow(df.hdi.m2))
df.hdi.l1$HDICategory <- rep(as.factor("Low human development"), nrow(df.hdi.l1))
df.hdi.l2$HDICategory <- rep(as.factor("Low human development"), nrow(df.hdi.l2))

# bind into a single HDI table
df.hdi <- do.call("rbind", list(df.hdi.vh1, df.hdi.vh2, df.hdi.h1, df.hdi.h2, 
                                df.hdi.m1, df.hdi.m2, df.hdi.l1, df.hdi.l2))
```

####  b. Write HDI Data Frame to csv
```{r}
write.csv(df.hdi, file = "csv/HDIByCountry.csv", row.names = F)
```

#### c. Merge HDI into Procrastination
```{r}
df.hdi$Country <- as.factor(df.hdi$Country)
df.procrastination <- merge(df.hdi, df.procrastination, by = "Country")
```
#4. Preliminary Analysis
#### 4a. Remove all observations where the participant is under age 18.  No further analysis of underage individuals is permitted by your client.  Remove any other age outliers as you see fit, but be sure to tell what youâ€™re doing and why. 
```{r}
# 146 entries are < 18 years of age
# 6 is.na(Age)
# 3,996 records before <18 filtering, 3,850 post <18 filtering

# less_than_eql_18 <-df.procrastination %>% filter(Age <= 18) %>% nrow()
# less_than_eql_18
# less_than_eql_18_data <-df.procrastination %>% filter(Age <= 18)

# age_is_na_data <-df.procrastination %>% filter(is.na(Age))

# pre_removal <- df.procrastination %>% nrow()
# pre_removal

# post_removal <- gtr18_data %>% nrow()
# post_removal
# pre_removal - post_removal
# (pre_removal - post_removal) - less_than_eql_18
# 
# x<-setdiff(df.procrastination,gtr18_data)
# x_diff<-setdiff(x,less_than_eql_18_data)

df.procrastination<- df.procrastination %>% filter(Age > 18 | is.na(Age))
#df.procrastination<- df.procrastination %>% filter(Age > 18)

# Six records were removed during the above step where is.na(Age).  The records could have been retain with the addition of the is.na(Age), but question 4B askes for descriptive statistics on the Age variable and the six records would be eliminated.

# ggplot(df.procrastination, aes(Gender, Age)) + geom_boxplot()
# ggplot(df.procrastination, aes(HDICategory, Age)) + geom_boxplot()

```

#### 4b. Please provide (in pretty-fied table format or similar), descriptive statistics on Age, Income, HDI, and the four mean columns (DP, etc.).  Create a simple histogram for two of these seven variables.  Comment on the shape of the distribution in your markdown.
```{r}
# https://stats.idre.ucla.edu/r/faq/how-can-i-get-a-table-of-basic-descriptive-statistics-for-my-variables/
# install.packages("pastecs")
library(pastecs)
attach(df.procrastination)

procrastination_summary <- cbind(Age, Income, as.double(HDI), DPMean, AIPMean, GPMean, SWLSMean)
colnames(procrastination_summary) <- c("Age", "Income", "HDI", "DPMean", "AIPMean","GPMean", "SWLSMean")
options(scipen=100)
options(digits=0)
#stat.desc(procrastination_summary, basic=F)
stat.desc(procrastination_summary)
procrastination_summary <- cbind(Age, Income)
procrastination_summary <- data.frame(procrastination_summary)


hist(procrastination_summary$Age, ylim = c(0,800), main="Age Frequency Distribution", 
     xlab="Age", border="blue", ylab = "Age Frequency", col="lightgreen") 

# Age distribution is skewed right with the bulk of the age between 20 and 45.

hist(procrastination_summary$Income, ylim = c(0,800), main="Income Frequency Distribution", 
     xlab="Income", border="blue", ylab = "Income Frequency", col="lightgreen") 

# Income distribution is skewed right with the bulk of the income between 0 and 100,000.
detach(df.procrastination)
```

#### 4c. Give the frequencies (in table format or similar) for Gender, Work Status, and Occupation.  They can be separate tables, if thatâ€™s your choice. 

##### 4c Gender
```{r}
df.procrastination %>% select(Gender) %>% group_by(Gender) %>% dplyr::summarise(Gender_Count = n())
```

##### 4c Work Status
```{r}
df.procrastination %>% select(WorkStatus) %>% group_by(WorkStatus) %>% dplyr::summarise(WorkStatus_Count = n())
```

##### 4c Occupation
```{r}
df.procrastination %>% select(Occupation) %>% group_by(Occupation) %>% dplyr::summarise(Occupation_Count = n())
```

#### 4d. Give the counts (again, pretty table) of how many participants per country in descending order.
```{r}
df.procrastination %>% select(Country) %>% group_by(Country) %>% 
  dplyr::summarise(Participant_Count = n()) %>% 
  plyr::arrange(desc(Participant_Count))
```

#### 4e. There are two variables in the set: whether the person considers themselves a procrastinator (yes/no) and whether others consider them a procrastinator (yes/no).  How many people matched their perceptions to othersâ€™ (so, yes/yes and no/no)?  To clarify: how many people said they felt they were procrastinators and also said others thought they were procrastinators? Likewise, how many said they were not procrastinators and others also did not think they were procrastinators? 

```{r}
  x <- df.procrastination %>% select(SelfView, ExtView)
  x$SelfView <- as.character(x$SelfView)
  x$ExtView <- as.character(x$ExtView)
  
  x %>% select(SelfView,ExtView) %>% ungroup() %>%
  filter(base::nchar(SelfView)>0 & base::nchar(ExtView)>0) %>% 
  filter(SelfView==ExtView) %>% group_by(SelfView) %>% 
  dplyr::summarise(InAgreement_Count = n()) %>% 
  rename(InAgreement = SelfView)
```

# 5. Deeper Analysis and Visualization

#### 5a. Note: You should make all of these appealing looking.  Remember to include things like a clean, informative title, axis labels that are in plain English, and readable axis values that do not overlap

#### 5b. Create a barchart in ggplot or similar which displays the top 15 nations in average procrastination scores, using one measure of the following: DP, AIP, or GP.  The bars should be in descending order, with the number 1 most procrastinating nation at the top and 15th most procrastinating at the bottom.  Omit all other nations.  Color the bars by HDI category (see 3B).  Use any color palette of your choice other than the default. 

```{r}
options(digits = 4)
  top_15_DP_HDI <- df.procrastination %>% select(Country, DPMean, HDI) %>% arrange(Country) %>% 
    group_by(Country, HDI) %>% summarise (Country_DPMean = mean(DPMean)) %>% 
    arrange(desc(Country_DPMean)) %>% head(n=15)
  
  ggplot(top_15_DP_HDI, aes(x= reorder(Country, Country_DPMean), y=Country_DPMean)) + geom_bar(aes(fill=HDI), stat = "identity") +      ggtitle("Top 15 Countries with highest DPMean and respective HDI Score") + xlab("Country") + coord_flip() + scale_fill_hue(l=72)
    
```

#### 5c. Create another barchart identical in features to 5B, but use another one of the three variables: DP, AIP, or GP.  How many nations show up both in 5Bâ€™s plot and 5Câ€™s?  Which, if any?

```{r}
options(digits = 4)
  top_15_AP_HDI <- df.procrastination %>% select(Country, AIPMean, HDI) %>% arrange(Country) %>% 
    group_by(Country, HDI) %>% summarise (Country_AIPMean = mean(AIPMean)) %>% 
    arrange(desc(Country_AIPMean)) %>% head(n=15)
  
ggplot(top_15_AP_HDI, aes(x= reorder(Country, Country_AIPMean), y=Country_AIPMean)) +        geom_bar(aes(fill=HDI), stat = "identity") +      
ggtitle("Top 15 Countries with highest APIPMean and respective HDI Score") + 
xlab("Country") + coord_flip() + scale_fill_hue(l=72)
    
```

```{r}

x %>% inner_join(top_15, by="Country") %>% 
  select(Country) %>%
  arrange(Country)%>%
  rename(DPMean_APIMean_Common_Countries=Country)
```

#### 5d. Is there a relationship between Age and Income?  Create a scatterplot and make an assessment of whether there is a relationship.  Color each point based on the Gender of the participant.  Youâ€™re welcome to use lm() or similar functions to back up your claims. 

```{r}
  y <- round(cor(df.procrastination$Age, df.procrastination$Income, use = "complete.obs"),4)*100

  df.procrastination %>% 
  ggplot(., aes(x=Age, y=Income)) +
  geom_point(aes(colour = factor(Gender)), na.rm = TRUE)  +  
  geom_smooth(aes(color="lm"), method=lm, se=TRUE, na.rm = TRUE) + 
  labs(color = "Legend") + 
  ggtitle(paste("Age vs. Income - Is there a Relathionship \n Correlation: ", y,"%")) +
  theme(plot.title = element_text(hjust = 0.5))
```
  
#### 5e. What about Life Satisfaction and HDI?  Create another scatterplot.  Is there a discernible relationship there?   

```{r}
  df.procrastination %>% 
  ggplot(., aes(x=SWLSMean, y=HDI)) +
  geom_point(na.rm = TRUE)  +  
  geom_smooth(aes(color="lm"), method=lm, se=FALSE, na.rm = TRUE) + 
  labs(color = "Legend") + 
  ggtitle("SWLSMean vs. HDI - Is there a Relationship") +
  theme(plot.title = element_text(hjust = 0.5))
```

#### 5e. What about if you used the HDI category instead and made a barplot? 
```{r}
  df.procrastination %>%
  ggplot(., aes(y = SWLSMean, x = HDICategory)) +
  geom_bar(stat = "identity", na.rm=TRUE) +
  labs(title = "HDI and Life Satisfaction - Is there a Relationship") +
  theme(plot.title = element_text(hjust = 0.5))
```

#### 6a The client would like the finalized HDI table (3A and 3B) 
```{r}
write.csv(df.hdi, file = "csv/HDIByCountry.csv", row.names = F)
```

#### 6b The client would like the Tidied version of the original input to be output in the repository, including the merged HDI data (3C). 

```{r}
df.procrastination <- merge(df.hdi, df.procrastination, by = "Country")
write.csv(df.procrastination, file = "csv/Question6b.csv", row.names = F)
```

#### 6c The client would like a dataset (or two) that shows the Top 15 nations (in 5B and 5C), as well as their HDI scores.

```{r}
Country_HDI <- top_15_AP_HDI %>% full_join(top_15_DP_HDI, by = c("Country", "HDI")) %>%
  select(Country, HDI) %>% arrange(desc(HDI))
```
